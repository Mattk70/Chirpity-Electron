<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!--meta http-equiv="Content-Security-Policy" content="script-src 'self'  'unsafe-inline'; worker-src  'self' 'unsafe-inline' 'unsafe-eval' "-->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https:">

    <!-- Bootstrap & CSS-->
    <script defer src="./node_modules/jquery/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css"/>
    <script defer src="./node_modules/@popperjs/core/dist/umd/popper.min.js"></script>
    <script defer src="./node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- Additional JavaScript & CSS -->
    <link rel="stylesheet" href="css/style.css"/>
    <link rel="stylesheet" href="css/daterangepicker.css"/>
    <script defer src="js/moment.min.js"></script>
    <script defer src="js/daterangepicker.js"></script>

    <!-- App title -->
    <title>Chirpity Bird Call Detection</title>

</head>
<body>


<!-- Navigation bar -->
<div id="navPadding" class="position-absolute top-0 w-100">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark" id="primary_nav_wrap">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main_nav"
                    aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="main_nav">
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown"
                           data-bs-toggle="dropdown">
                            File
                        </a>
                        <ul class="dropdown-menu">
                            <li><a id="open" class="dropdown-item" href="#"><u>O</u>pen Audio File </a></li>
                            <li><a class="dropdown-item disabled" id="saveLabels" href="#">
                                Save <u>A</u>udacity Labels</a></li>
                            <li><a class="dropdown-item disabled" id="exportMP3" href="#">
                                Export Selected Audio</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            <li><a class="dropdown-item" href="#" id="exit">Exit</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarRecords" role="button"
                           data-bs-toggle="dropdown"
                           aria-haspopup="true" aria-expanded="false">
                            Records
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarRecords">
                            <li class="dropdown-item disabled" href="#" id="save2db">Save Records</li>
                            <li class="dropdown-item disabled" href="#" id="charts">View charts</li>
                            <li class="dropdown-item disabled" href="#" id="explore">Explore records</li>
                            <li class="dropdown-item" href="#" id="dataset">Create Dataset</li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarAnalysis" role="button"
                           data-bs-toggle="dropdown"
                           aria-haspopup="true" aria-expanded="false">
                            Analysis
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item text-danger" href="#" id="warmup">Model Warming up
                                <div class="spinner-grow spinner-grow-sm" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </a></li>
                            <li><a class="dropdown-item disabled" href="#" id="analyse">Analyse File</a></li>
                            <li><a class="dropdown-item disabled" href="#" id="analyseSelection">Analyse Selected
                                Interval</a></li>
                            <li><a class="dropdown-item disabled" href="#" id="analyseAll">Analyse All Open Files</a>
                            </li>
                            <li class="dropdown-divider"></li>
                            <li><a class="dropdown-item disabled" href="#" id="reanalyse">Re-analyse File</a></li>
                            <li><a class="dropdown-item disabled" href="#" id="reanalyseAll">Re-analyse All Open
                                Files</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown" id="myDropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown"> Settings </a>
                        <ul class="navbar-nav dropdown-menu">
                            <li>
                                <form style="width: 540px;">
                                    <div class="row">
                                        <div class="col-6">
                                            <fieldset class="border rounded m-2 p-1">
                                                <legend style="font-size: large">Predictions</legend>
                                                <div class="form-group rounded p-2 mb-2 bg-light">
                                                    <label for="list-to-use">Model:</label>
                                                    <select class="form-control" id="model-to-use">
                                                        <option value="efficientnet">Chirpity</option>
                                                        <option value="BirdNet">BirdNet</option>
                                                    </select>
                                                </div>
                                                <div class="form-group rounded p-2 mb-2 bg-light">
                                                    <label for="confidence">Set threshold:</label>
                                                    <div class="input-group">
                                                        <input type="range" class="form-control-range" id="confidence"
                                                               min="5"
                                                               max="100"
                                                               step="5">
                                                        <div class="input-group-append">
                                                            <span class="input-group-text"
                                                                  id="confidence-value">50%</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="form-group rounded p-2 mb-2 bg-light">
                                                    <label for="list-to-use">Search For:</label>
                                                    <select class="form-control" id="list-to-use">
                                                        <option value="migrants">Migrants and Owls</option>
                                                        <option value="birds">Birds</option>
                                                        <option value="everything">Everything</option>
                                                    </select>
                                                </div>
                                            </fieldset>
                                        </div>
                                        <div class="col-6">
                                            <fieldset class="border rounded m-2 p-1">
                                                <legend style="font-size: large" >Location <span class="circle"  title="Location is solely used to determine dawn and dusk times for recordings">?</span> </legend>
                                                <div class="form-group rounded p-2 mb-2 bg-light">
                                                    <div class="input-group mb-2">
                                                        <span class="input-group-text pe-2">Lat:</span>
                                                        <input id="latitude" type="text" class="form-control  ps-1" placeholder="0.0"
                                                               aria-label="Latitude" aria-describedby="latitude">
                                                        <span class="input-group-text pe-2">Lon:</span>
                                                        <input id="longitude" type="text" class="form-control ps-1" placeholder="0.0"
                                                               aria-label="Longitude" aria-describedby="longitude">
                                                    </div>
                                                    <span id="place"></span>
                                                </div>
                                            </fieldset>
                                            <fieldset class="border rounded m-2 p-1">
                                                <legend style="font-size: large">Spectrogram</legend>
                                                <div class="form-group rounded p-2 mb-2 bg-light">
                                                    <label for="colourmap">Colourmap:</label>
                                                    <select class="form-control" id="colourmap">
                                                        <option value="greys">Greyscale</option>
                                                        <option value="inferno">Colour</option>
                                                    </select>
                                                </div>
                                                <div class="form-group rounded p-2 mb-2 bg-light">
                                                    <label for="timeline">Timeline:</label>
                                                    <select class="form-control" id="timelineSetting">
                                                        <option value="timecode">Timecode</option>
                                                        <option value="timeOfDay">Time of day</option>
                                                    </select>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                    <fieldset class="border rounded m-2 p-1">
                                        <legend style="font-size: large">System</legend>
                                        <div class="container">
                                            <div class="row">
                                                <div class="col">
                                                    <div class="form-group rounded p-2 mb-2 bg-light">
                                                        <label>Backend:</label>
                                                        <div class="form-check form-check-inline">
                                                            <input class="form-check-input" type="radio" name="backend"
                                                                   id="tensorflow"
                                                                   value="tensorflow" checked>
                                                            <label class="form-check-label" for="tensorflow">
                                                                CPU
                                                            </label>
                                                        </div>
                                                        <div class="form-check form-check-inline">
                                                            <input class="form-check-input" type="radio" name="backend"
                                                                   id="webgl"
                                                                   value="webgl">
                                                            <label class="form-check-label" for="webgl">
                                                                GPU
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col">
                                                    <div class="form-group rounded p-2 mb-2 bg-light">
                                                        <label for="thread-slider"
                                                               title="Number of parallel predictions to run.">Threads:</label>
                                                        <div class="input-group">
                                                            <input type="range" class="form-control-range"
                                                                   id="thread-slider" min="1"
                                                                   max="24">
                                                            <div class="input-group-append">
                                                                    <span class="input-group-text"
                                                                          id="threads-value">12</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col me-auto">
                                                    <div class="form-group rounded p-2 mb-2 bg-light">
                                                        <label for="snrValue" class="form-label"
                                                               title="Ignore samples with just background noise. Value is the minimum signal strength to look at.">Signal
                                                            to Noise Threshold:</label>
                                                        <div class="input-group">
                                                            <input type="range" class="form-control-range" min="0"
                                                                   max="10"
                                                                   step="0.5"
                                                                   id="snrValue">
                                                            <div class="input-group-append">
                                                                <span class="input-group-text"
                                                                      id="SNR-threshold">0</span>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="col ">
                                                    <div class="form-group rounded p-2 mb-2 bg-light">
                                                        <label for="batch-size"
                                                               title="Optimising the batch size can increase the prediction speed by 2-3x on longer files.&#10;If it is too large, the model will terminate.&#10;If that happens, set a lower batch size and restart Chirpity">Batch
                                                            Size:</label>
                                                        <div class="input-group">
                                                            <input type="range" class="form-control-range"
                                                                   id="batch-size"
                                                                   min="0"
                                                                   max="7">
                                                            <div class="input-group-append">
                                                            <span class="input-group-text"
                                                                  id="batch-size-value">2</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </fieldset>
                                </form>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown active">
                        <a class="nav-link dropdown-toggle" href="#" id="help" role="button" data-bs-toggle="dropdown"
                           aria-haspopup="true" aria-expanded="false">
                            Help
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" id="usage" href="#">Usage</a></li>
                            <li><a class="dropdown-item" id="settings" href="#">Settings</a></li>
                            <li><a class="dropdown-item" id="keyboard" href="#">Keyboard Shortcuts</a></li>
                            <li><a class="dropdown-item" id="diagnostics" href="#">Diagnostics</a></li>
                        </ul>
                    </li>
                </ul>

            </div>
            <!-- navbar-collapse.// -->
            <img src="img/logo/chirpity_logo2.png" alt="Chirpity bird calls: Identifying birds by sound"
                 height="50px"/>
        </div>
        <!-- container-fluid.// -->
    </nav>
</div>
<!-- Content wrapper -->
<div id="contentWrapper">
    <!-- DIV to Hold the bird list  -->
    <div id="allSpecies" class="d-none"></div>
    <div id="seenSpecies" class="d-none"></div>

    <!-- Diagnostic Modal -->
    <div class="modal fade" id="diagnosticsModal" tabindex="-1" aria-labelledby="diagnosticsModalLabel"
         aria-hidden="true">
        <div class="modal-dialog  modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header justify-content-center">
                    <h5 class="modal-title" id="diagnosticsModalLabel">Diagnostic Information</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    </button>
                </div>
                <div id="diagnosticsModalBody" class="modal-body"></div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Help Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog  modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header justify-content-center">
                    <h5 class="modal-title" id="helpModalLabel">Help</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div id="helpModalBody" class="modal-body"></div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Analyse selection modal -->
    <div class="modal fade" id="detectionsModal" tabindex="-1" aria-labelledby="detectionsModalLabel"
         aria-hidden="true">
        <div class="modal-dialog  modal-lg modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header justify-content-center text-bg-dark">
                    <h5 class="modal-title" id="detectionsModalLabel">Audio Selection Analysis</h5>
                </div>
                <div id="detectionsModalBody" class="modal-body p-0 ">
                    <table id='selectionResults' class="text-center table table-hover w-100">
                        <thead id="selectionResultsHead">
                        <tr class="text-bg-dark">
                            <th class="col">#</th>
                            <th class="col timestamp">Time</th>
                            <th class="text-start">Position</th>
                            <th class="text-start">Species</th>
                            <th class="col">Play</th>
                            <th class="col">XC</th>
                            <th class="col">Delete</th>
                            <th class="">Label</th>
                            <th class="col text-end">Notes</th>
                        </tr>
                        </thead>
                        <tbody class="text-dark" id="selectionResultTableBody">
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer justify-content-center">
                    <button id="detections-add" type="button" class="btn btn-success" data-bs-dismiss="modal">Confirm
                        Detections
                    </button>
                    <button id="detections-dismiss" type="button" class="btn btn-danger" data-bs-dismiss="modal">Discard
                        Detections
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Load audio file hint -->
    <div class="d-flex h-100 flex-column text-dark align-items-center justify-content-center" id="loadFileHint">
        <div class="">
            <p class="lead align-content-center" id="loadFileHintText">Load an audio file for analysis by
                selecting <span class="fst-italic"> "File > Open Audio File" </span> in the top menu.</p>
        </div>
        <div class="">
            <div class="d-none spinner-border" role="status" id="loadFileHintSpinner"></div>
        </div>
    </div>

    <!-- Explore Div -->
    <div id="exploreWrapper" class="p-1 row g-1 d-none">
        <div class="species-selector col-sm-4" id="exploreSpeciesSearch">
            <input type="text" class="input" placeholder="Search for a species...">
            <div class="explore bird-list-wrapper"></div>
        </div>
        <div class="col-sm-8 align-middle">
            <div class="text-center pointer" id="exploreRange"
                 style="font-size: 16px;padding: 12px 20px 12px 40px; width: 100%">
                <i class="material-icons-two-tone  align-bottom">date_range</i>&nbsp;
                <span>Apply a date filter</span> <i
                    class="material-icons-two-tone  align-bottom">expand_more</i>
            </div>
        </div>
    </div>

    <!-- Spectrogram view -->
    <div class="w-100 d-none" id="spectrogramWrapper">
        <div>
            <div class="bg-dark border border-secondary w-100" id="timeline"></div>
            <div class="w-100" id="spectrogram">
                <span title="Toggle Fullscreen mode" id="fullscreen"
                      class="material-icons-two-tone btn btn-outline-secondary p-1 pointer d-none">fullscreen</span>
            </div>
            <div class="w-100" id="waveform"></div>
        </div>
        <!-- Controls view -->
        <div class="container-fluid p-1 text-bg-dark d-inline-flex" id="controlsWrapper"
             style="max-height: 50px">

            <div id="filename" class="col-5 ps-1 overflow-visible flex-nowrap"></div>
            <div class="col btn-group bg-dark ps-1 pe-1 text-nowrap" role="group">
                <button id="playToggle" class="p-1 btn btn-outline-secondary">
                    <i class="material-icons-two-tone ">play_arrow</i><span
                        class="align-middle d-none d-lg-inline">Play  </span>
                    /
                    <i class="material-icons-two-tone ">pause</i><span
                        class="align-middle d-none d-lg-inline-block">Pause</span>
                </button>
            </div>

            <div class="col btn-group bg-dark  pe-2" role="group">
                <button id="zoomIn" title="Zoom into the spectrogram" class="btn btn-outline-secondary"
                        style="max-width: 70px">
                    <span class="material-icons-two-tone zoom">zoom_in</span>
                </button>
                <button id="zoomOut" title="Zoom out of the spectrogram" class="btn btn-outline-secondary"
                        style="max-width: 70px"><span class="material-icons-two-tone zoom align-middle">zoom_out</span>
                </button>
            </div>
            <div id="progressDiv" class="col-2" style="display:none"><span
                    id="fileNumber"></span><br>
                <progress id="progress-bar" max="100"></progress>
            </div>

            <div id="complete" class="col-2 pe-2" style="display:none">
            </div>
            <div class="col pe-1">
                <div class="btn-group float-end">
                    <span style="max-width: 70px" title="Nocmig mode on"
                          id="nocmigMode"
                          class="material-icons-two-tone btn btn-outline-secondary p-1 pt-2 pointer">bedtime</span>
                    <span style="max-width: 70px"
                          id="list-icon"
                          class="btn btn-outline-secondary p-1 pointer icon-container"><img class="icon"
                                                                                            src="img/migrants.png"></span>
                    <span style="max-width: 70px" title="Prediction confidence threshold"
                          id="threshold-value"
                          class="btn  btn-outline-secondary p-1 fs-5 pointer icon-container"><b>50%</b>
                        </span>
                    <span id="confidenceSliderContainer" class="d-none">
                            <input type="range" class="form-range vertical position-absolute" step="5"
                                   id="confidenceValue">
                    </span>
                </div>
            </div>
        </div>
    </div>
    <!-- Result container -->
    <div class="d-none" id="resultTableContainer">
        <div class="row g-0 h-100">
            <div class="col-sm-4 h-100 overflow-auto" id="summary">
                <!-- Summary table -->
                <!--                <div class="rounded-border">-->
                <div id='summaryTable'></div>
                <!--                </div>-->
            </div>
            <!-- Results table -->
            <div class="col-sm-8 ps-1 pe-0 h-100 position-relative overflow-auto" id="resultsDiv">
                <nav aria-label="Identification results">
                    <ul class="m-2 pagination justify-content-center"></ul>
                </nav>
                <table id='results' class="text-center table table-hover w-100">
                    <thead id="resultsHead">
                    <tr class="bg-dark">
                        <th class="col">#</th>
                        <th class="col text-start timestamp">Time</th>
                        <th id="time-sort" class="text-end pointer">Position</th>
                        <th id="species-sort" class="pointer">Species</th>
                        <th class="col">Play</th>
                        <th class="col">XC</th>
                        <th class="col">Delete</th>
                        <th class="">Label</th>
                        <th class="col text-end">Notes</th>
                    </tr>
                    </thead>
                    <tbody class="text-dark" id="resultTableBody">
                    </tbody>
                </table>
                <nav aria-label="Identification results">
                    <ul class="m-2 pagination justify-content-center"></ul>
                </nav>
            </div>
        </div>
    </div>
    <!-- Records container -->
    <div class="d-none h-100 overflow-auto p-2" id="recordsContainer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-3">
                    <div id="speciesSearch" class="species-selector">
                        <input type="text" class="input" placeholder="Search for a species...">
                        <div class="chart bird-list-wrapper"></div>
                    </div>
                    <div id='dataRecords' class="border border-dark rounded-border d-none">
                        <table class="table table-striped table-hover">
                            <tbody id="recordsTableBody">
                            <tr>
                                <th>Earliest Spring Record</th>
                                <td id="earliestSpring"></td>
                            </tr>
                            <tr>
                                <th>Latest Spring Record</th>
                                <td id="latestSpring"></td>
                            </tr>
                            <tr>
                                <th>Earliest Autumn Record</th>
                                <td id="earliestAutumn"></td>
                            </tr>
                            <tr>
                                <th>Latest Autumn Record</th>
                                <td id="latestAutumn"></td>
                            </tr>
                            <tr>
                                <th>Most Calls in 24 hours</th>
                                <td id="mostDetections"></td>
                            </tr>
                            <tr class="fst-italic text-sm-start">
                                <th>Chart generated in:</th>
                                <td id="genTime"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-sm-9">
                    <div class="row">
                        <div class="col text-center pointer" id="chartRange"
                             style="font-size: 16px;padding: 12px 20px 12px 40px; width: 100%">
                            <i class="material-icons-two-tone  align-bottom">date_range</i>&nbsp;
                            <span>Apply a date filter</span> <i
                                class="material-icons-two-tone  align-bottom">expand_more</i>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col chart-outer">
                            <div class="border border-dark rounded-3" id="chart-week"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Footer -->
<footer class="p-1 text-bg-primary" id="footer">
    <small>Chirpity Nocmig &copy; Matthew Kirkland <span id="year"></span><br><a
            href="https://www.flaticon.com/free-icons/">Some icons created by Freepik - Flaticon</a></small>
</footer>
<script defer src="node_modules/wavesurfer.js/dist/wavesurfer.min.js"></script>
<script defer src="node_modules/wavesurfer.js/dist/plugin/wavesurfer.spectrogram.min.js"></script>
<script defer src="node_modules/wavesurfer.js/dist/plugin/wavesurfer.timeline.min.js"></script>
<script defer src="node_modules/wavesurfer.js/dist/plugin/wavesurfer.regions.min.js"></script>
<script defer src="js/highcharts.js"></script>
<script defer src="js/series-label.js"></script>
<script defer src="js/exporting.js"></script>
<script defer src="js/export-data.js"></script>
<script defer src="js/accessibility.js"></script>
<script defer src="js/no-data-to-display.js"></script>

<script defer src="./js/ui.js"></script>
</body>
</html>